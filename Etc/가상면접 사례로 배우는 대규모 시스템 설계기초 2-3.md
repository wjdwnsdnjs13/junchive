# 5장 - 지표 모니터링 및 경보 시스템
## 1단계 - 문제 이해 및 설계 범위 확정
- 설계 범위 확정
  - Q) 시스템의 사용자는 누구인가, 대형 IT 업체 회사 내부 시스템인지, 데이터독 같은 SaaS 서비스인지?
    - A) 회사 내부 시스템임
  - Q) 어떤 지표를 수집해야 하는가?
    - A) 시스템 운영 지표(operational system metrics)를 수집.
      - CPU 부하, 메모리 사용률, 디스크 사용량 같은 저수준의 운영체제 사용률 지표
      - 서버가 처리하는 초당 요청 수(requests per second)
      - 사업 지표(business metrics)는 제외함.
  - Q) 모니터링할 인프라 규모는?
    - A) DAU는 1억, 1000개의 서버 풀이 있고 풀마다 100개의 서버 하드웨어를 유지함
  - Q) 지표 데이터 보관 기간은?
    - A) 1년 간 보관
  - Q) 장기 보관 시 지표의 해상도를 낮춰도 되는가?
    - A) 새로 수집한 데이터는 7일 보관, 7일 뒤에는 1분 단위 데이터로 30일 보관, 이후에는 1시간 단위 데이터로 변환해서 보관
  - Q) 경보 채널로 지원하는 것은?
    - A) 이메일, 전화, 페이저듀티, 웹훅 등을 지원
  - Q) 에러 로그나 액세스 로그 등에 대한 수집 기능도 필요한가?
    - A) 노
  - Q) 분산 시스템 추적(distributed system tracing)을 지원해야 하는가?
    - A) 노

### 개략적 요구사항 및 가정
- 대규모 인프라를 모니터링 함
  - DAU 1억
  - 서버 풀 1000개, 풀 당 서버 수 100개, 서버 당 100개의 운영 지표 수집.
    - 모니터링 해야하는 지표의 수는 천만 개 수준
  - 데이터 보관 기간은 1년
  - 수집한 그대로 데이터를 일주일간 보관, 7일 이후에는 1분 단위 데이터로 30일간 보관, 30일 이후에는 1시간 단위 데이터로 보관
- 모니터링할 지표
  - CPU 사용률
  - 요청 수
  - 메모리 사용량
  - 메시지 큐 내의 메시지 수

### 비기능 요구사항
- 규모 확장성
- 낮은 응답 지연
- 안정성
- 유연성
  - 기술 변화에 따라 새로운 기술을 쉽게 통합할 수 있게 유연하고 변경 가능한 파이프라인을 이용해 구축


- 고려하지 않아도 되는 요구사항
  - 엘라스틱서치, 로그스태시, 키바나 등과 같은 로그 모니터링 시스템
  - 분산 시스템 추적
    - 서비스에 대한 요청이 분산 시스템 내부를 어떻게 흘러 다니는지 추적할 수 있는 시스템
    - 요청이 한 서비스에서 다른 서비스로 이동할 때마다 데이터를 수집


## 2단계 - 개략적 설계안 제시 및 동의 구하기
### 기본적 사항
- 데이터 수집
- 데이터 전송
- 데이터 저장소
- 경보
- 시각화

### 데이터 모델
- 지표 데이터는 통상 시계열(time series) 데이터 형태로 기록함
  - 값 집합에 타임스탬프가 붙은 형태로 기록한다는 의미
- 시계열에는 고유한 이름이 붙고, 선택적으로 레이블(label)을 붙이기도 함 

### 데이터 접근 패턴
- 쓰기 부하가 막대함
- 읽기 부하는 일시적으로 잠시 치솟았다가 사라짐(spiky)

### 데이터 저장소 시스템
- RDB는 시계열 데이터 읽기 연산에 최적화되어 있지 않음
- NoSQL는 확장이 용이한 스키마를 사용하기 위해서 깊은 지식이 필요함.
- InfluxDB나 프로메테우스 등을 사용
## 3단계 - 상세 설계


## 4단계 - 마무리


---
# 6장 - 광고 클릭 이벤트 집계